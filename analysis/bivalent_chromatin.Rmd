---
title: "Histone marks on bivalent chromatin"
author: "Carmen Navarro"
date: "2021-02-03"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
params:
  datadir: /home/carmen/work/publications/hesc-epigenomics/data
  biv: /home/carmen/work/publications/hesc-epigenomics/data/bed/Bivalent_Court2017.hg38.bed
  styles: /home/carmen/work/publications/hesc-epigenomics/data/meta/style_info.csv
---

# Summary

This is a study on bivalent chromatin regions.

As a base annotation we use the bivalent regions annotated in Court 2017:

Court, Franck, and Philippe Arnaud. "An annotated list of bivalent chromatin
regions in human ES cells: a new tool for cancer epigenetic research."
Oncotarget 8.3 (2017): 4110.

Additionally, the bivalent genes annotated as such in their supplementary
file 1: https://www.oncotarget.com/index.php?journal=oncotarget&page=article&op=downloadSuppFile&path%5B%5D=13746&path%5B%5D=21048

**Bivalent regions file:** Original regions were translated to hg38 with 
liftOver: `data/bed/Bivalent_Court2017.hg38.bed`.

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(wigglescout)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
library(org.Hs.eg.db)
library(GenomicRanges)
library(rtracklayer)
library(ggplot2)
source("./code/embed_functions.R")
source("./code/globals.R")
knitr::opts_chunk$set(dev = c('png', 'my_svg'), fig.ext = c("png", "svg"), fig.width = 8, fig.height = 8)
```

```{r helper-functions}
colors_list <- c("Naive_EZH2i"="#5F9EA0",
                 "Naive_Untreated"="#278b8b",
                 "Primed_EZH2i"="#f47770",
                 "Primed_Untreated"="#f44b34")

style_info <- read.table(params$styles, header = T, sep = "\t")
rownames(style_info) <- style_info$bw
```

# Bivalent regions
```{r bivalent-summary}
biv_ranges <- import(params$biv, )
biv_ranges
``` 


## H3K4m3 

```{r h3k4m3-court-biv-profile, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H3K4m3.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(c(bwfiles, bwinput)), "color_cond"])
labels <- style_info[basename(c(bwfiles, bwinput)), "label"]

plot_bw_profile(
  c(bwfiles, bwinput),
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels
) + ggtitle("H3K4m3 at bivalent regions")

``` 

Norm to input:

```{r h3k4m3-court-biv-profile-norm, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H3K4m3.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(bwfiles), "color_cond"])
labels <- style_info[basename(bwfiles), "label"]

plot_bw_profile(
  bwfiles,
  bg_bwfiles = bwinput,
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels
) + ggtitle("H3K4m3 at bivalent regions")

``` 

## H3K27m3

```{r h3k27m3-court-biv-profile, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H3K27m3.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(c(bwfiles, bwinput)), "color_cond"])
labels <- style_info[basename(c(bwfiles, bwinput)), "label"]

plot_bw_profile(
  c(bwfiles, bwinput),
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels
) + ggtitle("H3K27m3 at bivalent regions")

``` 

Norm to input:

```{r h3k27m3-court-biv-profile-norm, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H3K27m3.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(bwfiles), "color_cond"])
labels <- style_info[basename(bwfiles), "label"]

plot_bw_profile(
  bwfiles, 
  bg_bwfiles = bwinput,
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels,
  bin_size = 200
) + ggtitle("H3K27m3 at bivalent regions")

``` 

## H2AUb

```{r h2aub-court-biv-profile, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H2A.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(c(bwfiles, bwinput)), "color_cond"])
labels <- style_info[basename(c(bwfiles, bwinput)), "label"]

plot_bw_profile(
  c(bwfiles, bwinput),
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels
) + ggtitle("H2Aub at bivalent regions")

``` 

Norm to input:

```{r h2aub-court-biv-profile-norm, fig.width=8, fig.height=7, message=F}
bwfiles <- list.files(file.path(params$datadir, "bw/Kumar_2020/"), full.names = T)

bwinput <- bwfiles[grepl("IN.*pooled", bwfiles)]
bwfiles <- bwfiles[grepl("H2A.*pooled.hg38.scaled", bwfiles)]

colors <- as.character(style_info[basename(bwfiles), "color_cond"])
labels <- style_info[basename(bwfiles), "label"]

plot_bw_profile(
  bwfiles, 
  bg_bwfiles = bwinput,
  params$biv,
  mode = "center",
  upstream = 10000,
  downstream = 10000,
  colors = colors,
  labels = labels,
  bin_size = 200
) + ggtitle("H2Aub at bivalent regions")

``` 


